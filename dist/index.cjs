var o=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var c=Object.prototype.hasOwnProperty;var i=(t,e)=>{for(var u in e)o(t,u,{get:e[u],enumerable:!0})},l=(t,e,u,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of $(e))!c.call(t,n)&&n!==u&&o(t,n,{get:()=>e[n],enumerable:!(r=y(e,n))||r.enumerable});return t};var f=t=>l(o({},"__esModule",{value:!0}),t);var x={};i(x,{callProcedure:()=>m,protocolClient:()=>O,protocolContract:()=>I,protocolProcedure:()=>T,registerProcedures:()=>h});module.exports=f(x);var p=require("@the-minimal/protocol"),I=t=>({type:t.type,path:t.path,headers:t.headers??{},input:{encode:e=>(0,p.encode)(t.input,e),decode:e=>(0,p.decode)(t.input,e)},output:{encode:e=>(0,p.encode)(t.output,e),decode:e=>(0,p.decode)(t.output,e)}}),T=(t,e)=>({contract:t,handler:async u=>{let r=await u.arrayBuffer(),n=t.input.decode(r),a=await e(n),s=t.output.encode(a);return new Response(s,{status:200})}}),O=(t,e)=>async u=>{let n=await(await fetch(`${t}${e.path}`,{method:e.type==="query"?"GET":"POST",headers:{...e.headers,"content-type":"application/octet-stream"},body:e.input.encode(u)})).arrayBuffer();return e.output.decode(n)},d=new Map,h=t=>{for(let e=0;e<t.length;++e)d.set(`${t[e].contract.type}:${t[e].contract.path}`,t[e])},m=t=>{let e=new URL(t.url),u=`${t.method==="GET"?"query":"mutation"}:${e.pathname}`,r=d.get(u);return r?r.handler(t):new Response(null,{status:404,statusText:"Procedure not found"})};0&&(module.exports={callProcedure,protocolClient,protocolContract,protocolProcedure,registerProcedures});
